<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <script src="../js/jquery.js"></script>
    <script src="../js/marked.js"></script>
    <script src="../js/bootstrap.min.js"></script>

    <!--Reference https://qiita.com/legokichi/items/27b7b865a0ab28b5d530 -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      skipStartupTypeset: true, // ページロード時のmathjax発動禁止
      extensions: ["tex2jax.js"],
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      "HTML-CSS": {
        availableFonts: ["TeX"]
      }
    });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntil=configured"></script>
    <script src="../js/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntil=configured"></script>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/bootstrap-grid.min.css">
    <link rel="stylesheet" href="../css/bootstrap-reboot.min.css">
    <link rel="stylesheet" href="../css/app.css">
    <link rel="shortcut icon" href="../nanyouhagi_base_a.png" type="nanyouhagi_base_a.png">
</head>

<body>
    <div id="header"></div>

    <div class="container">
        <div class="row">
            <div id="content" class="col-sm-12 cell-padding"></div>
        </div>
    </div>

    <script>
        $('#header').load('../header.html', function () {
        });

        window.addEventListener("DOMContentLoaded", main);
        window.addEventListener("hashchange", main);

        var get = $.get;
        marked.setOptions({
            renderer: new marked.Renderer(),
            gfm: true,
            tables: true,
            breaks: true,
            pedantic: false,
            sanitize: false,
            smartLists: false,
            smartypants: false
        });

        function main() {
            // ルーティング
            var name = "";
            if (location.hash.length <= 1) {
                name = "Fast R-CNN.md";
                location.hash = "#" + name;
            } else {
                name = location.hash.slice(1);
            }
            document.title = decodeURI(name).replace(".md","") + " - Paper-Reminder"
            // ページ内リンクなのでhistory.pushStateする必要はない
            get(name).catch(function () {
                return Promise.resolve("# 404 page not found");
            }).then(function (text) {
                // markedにlatexタグ食わせると&<>とかがエスケープされるので<pre />で包んで退避
                // ちなみに```mathとかで<pre><code class="lang-math">になったのはエスケープされるので注意
                var PREFIX = "<pre><code class=\"lang-math\">";
                var SUFFIX = "</code></pre>";
                var reg = new RegExp(
                    ("(?:" + PREFIX + "([\\s\\S]*?)" + SUFFIX + ")")
                        .replace(/\//g, "\/"),
                    "gm");
                var wraped = text.split("$$")
                    .reduce(function (sum, str, i) {
                        return i % 2 === 0 ?
                            sum + str :
                            sum + PREFIX + str + SUFFIX;
                    }, "");
                var html = marked(wraped);
                // 退避したlatexタグを$$で包み直す
                var _html = html;
                var tuple = null;
                while (tuple = reg.exec(html)) {
                    _html = _html.split(tuple[0]).join("$$" + tuple[1] + "$$");
                }
                // mathjaxで処理
                var div = document.getElementById("content");
                div.innerHTML = _html;
                MathJax.Hub.Configured();
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
            }).catch(function (err) {
                // jqueryのpromiseはthenの中でエラー吐いて止まってもconsoleに表示してくれないので表示させる
                console.error(err);
            });
        }
    </script>
</body>

</html>